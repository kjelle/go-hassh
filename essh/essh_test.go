package essh

import (
	"testing"

	"github.com/google/gopacket"
)

var testSShPacket = map[string]struct {
	data             []byte
	proto_version    string
	software_version string
}{
	"Identification String and Kexinit": {
		data:             append([]byte("SSH-2.0-OpenSSH_7.4"), decodeString(`0d0a000005d40b1492c601dc57d2e6b5398f52ee39fa67910000014b637572766532353531392d7368613235362c637572766532353531392d736861323536406c69627373682e6f72672c656364682d736861322d6e697374703235362c656364682d736861322d6e697374703338342c656364682d736861322d6e697374703532312c6469666669652d68656c6c6d616e2d67726f75702d65786368616e67652d7368613235362c6469666669652d68656c6c6d616e2d67726f757031362d7368613531322c6469666669652d68656c6c6d616e2d67726f757031382d7368613531322c6469666669652d68656c6c6d616e2d67726f75702d65786368616e67652d736861312c6469666669652d68656c6c6d616e2d67726f757031342d7368613235362c6469666669652d68656c6c6d616e2d67726f757031342d736861312c6469666669652d68656c6c6d616e2d67726f7570312d736861312c6578742d696e666f2d630000014765636473612d736861322d6e697374703235362d636572742d763031406f70656e7373682e636f6d2c65636473612d736861322d6e697374703338342d636572742d763031406f70656e7373682e636f6d2c65636473612d736861322d6e697374703532312d636572742d763031406f70656e7373682e636f6d2c65636473612d736861322d6e697374703235362c65636473612d736861322d6e697374703338342c65636473612d736861322d6e697374703532312c7373682d656432353531392d636572742d763031406f70656e7373682e636f6d2c7373682d7273612d636572742d763031406f70656e7373682e636f6d2c7373682d6473732d636572742d763031406f70656e7373682e636f6d2c7373682d656432353531392c7273612d736861322d3531322c7273612d736861322d3235362c7373682d7273612c7373682d6473730000008d63686163686132302d706f6c7931333035406f70656e7373682e636f6d2c6165733132382d6374722c6165733139322d6374722c6165733235362d6374722c6165733132382d67636d406f70656e7373682e636f6d2c6165733235362d67636d406f70656e7373682e636f6d2c6165733132382d6362632c6165733139322d6362632c6165733235362d6362630000008d63686163686132302d706f6c7931333035406f70656e7373682e636f6d2c6165733132382d6374722c6165733139322d6374722c6165733235362d6374722c6165733132382d67636d406f70656e7373682e636f6d2c6165733235362d67636d406f70656e7373682e636f6d2c6165733132382d6362632c6165733139322d6362632c6165733235362d636263000000d5756d61632d36342d65746d406f70656e7373682e636f6d2c756d61632d3132382d65746d406f70656e7373682e636f6d2c686d61632d736861322d3235362d65746d406f70656e7373682e636f6d2c686d61632d736861322d3531322d65746d406f70656e7373682e636f6d2c686d61632d736861312d65746d406f70656e7373682e636f6d2c756d61632d3634406f70656e7373682e636f6d2c756d61632d313238406f70656e7373682e636f6d2c686d61632d736861322d3235362c686d61632d736861322d3531322c686d61632d73686131000000d5756d61632d36342d65746d406f70656e7373682e636f6d2c756d61632d3132382d65746d406f70656e7373682e636f6d2c686d61632d736861322d3235362d65746d406f70656e7373682e636f6d2c686d61632d736861322d3531322d65746d406f70656e7373682e636f6d2c686d61632d736861312d65746d406f70656e7373682e636f6d2c756d61632d3634406f70656e7373682e636f6d2c756d61632d313238406f70656e7373682e636f6d2c686d61632d736861322d3235362c686d61632d736861322d3531322c686d61632d736861310000001a6e6f6e652c7a6c6962406f70656e7373682e636f6d2c7a6c69620000001a6e6f6e652c7a6c6962406f70656e7373682e636f6d2c7a6c6962000000000000000000000000000000000000000000000000`)...),
		proto_version:    "2.0",
		software_version: "OpenSSH_7.4",
	},
}

func TestSshPacket(t *testing.T) {
	for k, test := range testSShPacket {
		t.Run(k, func(t *testing.T) {
			t.Log(k)
			s := &ESSH{}
			err := s.decodeESSHRecords(test.data, gopacket.NilDecodeFeedback)
			if err != nil {
				t.Fatal(err)
			}

			t.Logf("Banner: %+v", s.Banner)
			t.Logf("Kexinit: %+v", s.Kexinit)

			/*			if r.ProtoVersion != test.proto_version {
							t.Errorf("failed testcase '%s', mismatch on ProtoVersion\n\nexpected:\n%s\ngot: \n%s\n", k, test.proto_version, r.ProtoVersion)
						}
						if r.SoftwareVersion != test.software_version {
							t.Errorf("failed testcase '%s', mismatch on SoftwareVersion\n\nexpected:\n%s\ngot: \n%s\n", k, test.software_version, r.SoftwareVersion)
						}*/

		})
	}
}
